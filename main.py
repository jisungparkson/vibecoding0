import streamlit as st

# --- í˜ì´ì§€ ì„¤ì • ---
st.set_page_config(page_title="MBTI ì‹¬ì¸µ ë¶„ì„", page_icon="ğŸ”¬")

# --- MBTI ìœ í˜• ë°ì´í„° (ì™¸ë¶€ íŒŒì¼ë¡œ ë¶„ë¦¬í•˜ëŠ” ê²ƒì´ ì´ìƒì ) ---
# ì˜ˆì‹œ: ê° ìœ í˜•ë³„ ìƒì„¸ ì •ë³´ (ê°œìš”, ê°•ì , ì•½ì , ì—…ë¬´ ìŠ¤íƒ€ì¼, ìŠ¤íŠ¸ë ˆìŠ¤ ë°˜ì‘, ê°œë°œí•  ì  ë“±)
mbti_details = {
    "ISTJ": {
        "icon": "ê¼¼ê¼¼í•œ_ISTJ_ì•„ì´ì½˜.png", # ê°€ìƒì˜ ì´ë¯¸ì§€ íŒŒì¼
        "catchphrase": "ì„¸ìƒì˜ ì†Œê¸ˆ, ì±…ì„ê° ìˆëŠ” í˜„ì‹¤ì£¼ì˜ì",
        "summary": "ì‹¤ì œ ê²½í—˜ì„ ì¤‘ì‹œí•˜ë©°, í•œë²ˆ ì‹œì‘í•œ ì¼ì€ ëê¹Œì§€ í•´ë‚´ëŠ” ì±…ì„ê°ì´ ê°•í•œ ìœ í˜•ì…ë‹ˆë‹¤. ì•½ì†ì„ ì˜ ì§€í‚¤ê³  ì§ˆì„œì™€ ê·œì¹™ì„ ì¤‘ìš”í•˜ê²Œ ìƒê°í•©ë‹ˆë‹¤.",
        "strengths": ["ì±…ì„ê° ê°•í•¨", "ì² ì €í•¨", "í˜„ì‹¤ì ", "ì¡°ì§ì ", "ëˆê¸° ìˆìŒ"],
        "weaknesses": ["ìœµí†µì„± ë¶€ì¡± ê°€ëŠ¥ì„±", "ìƒˆë¡œìš´ ë³€í™”ì— ëŒ€í•œ ì €í•­ê°", "íƒ€ì¸ì˜ ê°ì • ê³ ë ¤ ë¯¸í¡ ê°€ëŠ¥ì„±"],
        "work_style": "êµ¬ì²´ì ì´ê³  ëª…í™•í•œ ì—…ë¬´ ì§€ì‹œë¥¼ ì„ í˜¸í•˜ë©°, ì²´ê³„ì ì¸ ê³„íš í•˜ì— ì—…ë¬´ë¥¼ ìˆ˜í–‰í•©ë‹ˆë‹¤. ë§ˆê° ê¸°í•œì„ ì² ì €íˆ ì¤€ìˆ˜í•©ë‹ˆë‹¤.",
        "stress_response": "ê³¼ë„í•œ ì—…ë¬´ëŸ‰ì´ë‚˜ ì˜ˆì¸¡ ë¶ˆê°€ëŠ¥í•œ ìƒí™©ì—ì„œ ìŠ¤íŠ¸ë ˆìŠ¤ë¥¼ ë°›ìœ¼ë©°, í˜¼ìë§Œì˜ ì‹œê°„ì„ í†µí•´ íšŒë³µí•˜ë ¤ëŠ” ê²½í–¥ì´ ìˆìŠµë‹ˆë‹¤.",
        "development_points": ["ìƒˆë¡œìš´ ì‹œë„ì— ëŒ€í•œ ê°œë°©ì„± ê¸°ë¥´ê¸°", "íƒ€ì¸ì˜ ê°ì •ì— ëŒ€í•œ ê³µê° ëŠ¥ë ¥ í–¥ìƒ"],
        "recommended_jobs_detailed": {
            "íšŒê³„ì‚¬": {
                "reason": "ì •í™•ì„±, ê¼¼ê¼¼í•¨, ê·œì¹™ ì¤€ìˆ˜ë¥¼ ì¤‘ì‹œí•˜ëŠ” ISTJì˜ ì„±í–¥ê³¼ ì˜ ë§ìŠµë‹ˆë‹¤.",
                "tasks": ["ì¬ë¬´ ê¸°ë¡ ë¶„ì„", "ì„¸ë¬´ ë³´ê³ ì„œ ì‘ì„±", "ì˜ˆì‚° ê´€ë¦¬"],
                "skills": ["ìˆ˜ë¦¬ ëŠ¥ë ¥", "ë¶„ì„ì  ì‚¬ê³ ", "ì„¸ë²• ì§€ì‹"]
            },
            "í”„ë¡œì íŠ¸ ê´€ë¦¬ì": {
                "reason": "ì²´ê³„ì ì¸ ê³„íš ìˆ˜ë¦½ ë° ì‹¤í–‰, ì¼ì • ê´€ë¦¬ì— ëŠ¥í•œ ISTJì—ê²Œ ì í•©í•©ë‹ˆë‹¤.",
                "tasks": ["í”„ë¡œì íŠ¸ ê³„íš ë° ì‹¤í–‰", "ìì› ë°°ë¶„", "ìœ„í—˜ ê´€ë¦¬"],
                "skills": ["ë¦¬ë”ì‹­", "ì¡°ì§ë ¥", "ë¬¸ì œ í•´ê²° ëŠ¥ë ¥"]
            }
            # ... ê¸°íƒ€ ì§ì—… ìƒì„¸ ì •ë³´
        }
    },
    # ... ë‹¤ë¥¸ MBTI ìœ í˜• ìƒì„¸ ì •ë³´
}

# --- MBTI ê²€ì‚¬ ë¡œì§ (ê°œì„ ëœ ë°©ì‹) ---
def run_mbti_test():
    st.subheader("ğŸ” MBTI ê°„ì´ ê²€ì‚¬")
    st.caption("ê° ë¬¸í•­ì— ëŒ€í•´ ìì‹ ì—ê²Œ ë” ê°€ê¹ë‹¤ê³  ìƒê°ë˜ëŠ” ìª½ì„ ì„ íƒí•´ì£¼ì„¸ìš”. ê¹Šì´ ìƒê°í•˜ê¸°ë³´ë‹¤ ë– ì˜¤ë¥´ëŠ” ëŒ€ë¡œ ì‘ë‹µí•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.")

    questions = {
        "E/I": [
            ("ë‚˜ëŠ” ì—¬ëŸ¬ ì‚¬ëŒë“¤ê³¼ ë„“ê²Œ êµë¥˜í•˜ëŠ” í¸ì´ë‹¤", "E"),
            ("ë‚˜ëŠ” ì†Œìˆ˜ì˜ ì‚¬ëŒë“¤ê³¼ ê¹Šê²Œ êµë¥˜í•˜ëŠ” í¸ì´ë‹¤", "I"),
            ("ë‚˜ëŠ” í™œë™ì ì¸ ëª¨ì„ì—ì„œ ì—ë„ˆì§€ë¥¼ ì–»ëŠ”ë‹¤", "E"),
            ("ë‚˜ëŠ” ì¡°ìš©í•œ í™˜ê²½ì—ì„œ í˜¼ì ìƒê°í•  ë•Œ ì—ë„ˆì§€ë¥¼ ì–»ëŠ”ë‹¤", "I"),
        ],
        "S/N": [
            ("ë‚˜ëŠ” í˜„ì¬ì˜ ì‹¤ì œì ì¸ ì •ë³´ì— ì§‘ì¤‘í•œë‹¤", "S"),
            ("ë‚˜ëŠ” ë¯¸ë˜ì˜ ê°€ëŠ¥ì„±ê³¼ ì•„ì´ë””ì–´ì— ì§‘ì¤‘í•œë‹¤", "N"),
            ("ë‚˜ëŠ” êµ¬ì²´ì ì´ê³  ì‚¬ì‹¤ì ì¸ ì„¤ëª…ì„ ì„ í˜¸í•œë‹¤", "S"),
            ("ë‚˜ëŠ” ë¹„ìœ ì ì´ê³  ì•”ì‹œì ì¸ ì„¤ëª…ì„ ì„ í˜¸í•œë‹¤", "N"),
        ],
        "T/F": [
            ("ë‚˜ëŠ” ê°ê´€ì ì¸ ì‚¬ì‹¤ê³¼ ë…¼ë¦¬ì— ê·¼ê±°í•´ ê²°ì •í•œë‹¤", "T"),
            ("ë‚˜ëŠ” ì‚¬ëŒë“¤ê³¼ì˜ ê´€ê³„ì™€ ê°ì •ì„ ê³ ë ¤í•´ ê²°ì •í•œë‹¤", "F"),
            ("ë‚˜ëŠ” ê³µì •ì„±ê³¼ ì›ì¹™ì„ ì¤‘ìš”í•˜ê²Œ ìƒê°í•œë‹¤", "T"),
            ("ë‚˜ëŠ” ì¡°í™”ì™€ ê³µê°ì„ ì¤‘ìš”í•˜ê²Œ ìƒê°í•œë‹¤", "F"),
        ],
        "J/P": [
            ("ë‚˜ëŠ” ë¯¸ë¦¬ ê³„íšì„ ì„¸ìš°ê³  ì²´ê³„ì ìœ¼ë¡œ ì¼ì„ ì²˜ë¦¬í•œë‹¤", "J"),
            ("ë‚˜ëŠ” ìƒí™©ì— ë§ì¶° ìœ ì—°í•˜ê²Œ ì¼ì„ ì²˜ë¦¬í•˜ëŠ” í¸ì´ë‹¤", "P"),
            ("ë‚˜ëŠ” ê²°ì •ëœ ì‚¬í•­ì„ ë¹¨ë¦¬ ë§ˆë¬´ë¦¬ ì§“ëŠ” ê²ƒì„ ì„ í˜¸í•œë‹¤", "J"),
            ("ë‚˜ëŠ” ê°€ëŠ¥í•œ ë§ì€ ì„ íƒì§€ë¥¼ ì—´ì–´ë‘ëŠ” ê²ƒì„ ì„ í˜¸í•œë‹¤", "P"),
        ]
    }

    scores = {"E": 0, "I": 0, "S": 0, "N": 0, "T": 0, "F": 0, "J": 0, "P": 0}
    
    for key, q_list in questions.items():
        st.markdown(f"**{key.split('/')[0]} (ì™¸í–¥/ë‚´í–¥ ë“±) ì„ í˜¸ ì§€í‘œ:**") # ì‹¤ì œ ì§€í‘œëª…ìœ¼ë¡œ ë³€ê²½
        for i, (q_text, q_type) in enumerate(q_list):
            # ì¢€ ë” ì„¸ë¶„í™”ëœ ì„ íƒì§€ë¥¼ ì œê³µí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. (ì˜ˆ: 5ì  ì²™ë„)
            # ì—¬ê¸°ì„œëŠ” ë‹¨ìˆœí™”ë¥¼ ìœ„í•´ ë¼ë””ì˜¤ ë²„íŠ¼ ìœ ì§€
            answer = st.radio(f"{q_text}", ("ì„ íƒ1", "ì„ íƒ2"), key=f"{key}_{i}", horizontal=True, label_visibility="collapsed")
            # ì‹¤ì œë¡œëŠ” ì„ íƒì§€ì— ë”°ë¼ ì ìˆ˜ë¥¼ ë‹¤ë¥´ê²Œ ë¶€ì—¬í•´ì•¼ í•©ë‹ˆë‹¤.
            # ì˜ˆì‹œ: 'ì„ íƒ1'ì´ Eì— ê°€ê¹ë‹¤ë©´ scores[q_type] += 1
            # ì´ ë¶€ë¶„ì€ ì§ˆë¬¸ ì„¤ê³„ì— ë”°ë¼ ì •êµí•˜ê²Œ ë§Œë“¤ì–´ì•¼ í•©ë‹ˆë‹¤.
            # ì„ì‹œë¡œ ì²«ë²ˆì§¸ ì„ íƒì´ í•´ë‹¹ íƒ€ì…ì´ë¼ê³  ê°€ì •
            if answer == "ì„ íƒ1": # ì´ ë¶€ë¶„ì„ ì‹¤ì œ ë¡œì§ì— ë§ê²Œ ìˆ˜ì •
                 scores[q_type] +=1


    if st.button("ê²°ê³¼ ë¶„ì„í•˜ê¸°", type="primary"):
        result_mbti = ""
        result_mbti += "E" if scores["E"] >= scores["I"] else "I"
        result_mbti += "S" if scores["S"] >= scores["N"] else "N"
        result_mbti += "T" if scores["T"] >= scores["F"] else "F"
        result_mbti += "J" if scores["J"] >= scores["P"] else "P"
        st.session_state.mbti_result = result_mbti
        st.session_state.mbti_scores = scores # ì ìˆ˜ë„ ì €ì¥í•˜ì—¬ í™œìš© ê°€ëŠ¥

        st.success(f"ê²€ì‚¬ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤! ë‹¹ì‹ ì˜ ì˜ˆìƒ MBTI ìœ í˜•ì€ **{result_mbti}** ì…ë‹ˆë‹¤.")
        st.balloons()


# --- í˜ì´ì§€ ì‹œì‘ ---
st.title("ğŸ”¬ MBTI ì‹¬ì¸µ ë¶„ì„ ë° ì§ì—… íƒìƒ‰")

if 'mbti_result' not in st.session_state:
    run_mbti_test()
else:
    user_mbti = st.session_state.mbti_result
    st.header(f"ğŸŒŸ {user_mbti} ìœ í˜• ë¶„ì„ ê²°ê³¼")

    if user_mbti in mbti_details:
        details = mbti_details[user_mbti]
        
        # ì•„ì´ì½˜ ë° ìºì¹˜í”„ë ˆì´ì¦ˆ
        # if details.get("icon"):
        #     st.image(details["icon"], width=100) # ì‹¤ì œ ì´ë¯¸ì§€ ê²½ë¡œ ì„¤ì •
        st.subheader(f"*{details.get('catchphrase', '')}*")
        st.markdown(f"**ê°œìš”:** {details.get('summary', 'ì •ë³´ ì—†ìŒ')}")

        # íƒ­ìœ¼ë¡œ ìƒì„¸ ì •ë³´ ì œê³µ
        tab1, tab2, tab3, tab4 = st.tabs(["ğŸ’ª ê°•ì ê³¼ ì•½ì ", "ğŸ‘” ì—…ë¬´ ìŠ¤íƒ€ì¼", "ğŸ˜¥ ìŠ¤íŠ¸ë ˆìŠ¤ì™€ ê°œë°œì ", "ğŸ¯ ì¶”ì²œ ì§ì—…"])

        with tab1:
            st.subheader("ğŸ‘ ê°•ì ")
            for strength in details.get("strengths", []):
                st.markdown(f"- {strength}")
            st.subheader("ğŸ‘ ë³´ì™„í•  ìˆ˜ ìˆëŠ” ì ")
            for weakness in details.get("weaknesses", []):
                st.markdown(f"- {weakness}")
        
        with tab2:
            st.markdown(f"**ì£¼ìš” ì—…ë¬´ ìŠ¤íƒ€ì¼:** {details.get('work_style', 'ì •ë³´ ì—†ìŒ')}")
            # ì¶”ê°€ì ì¸ ì—…ë¬´ ê´€ë ¨ íŒì´ë‚˜ ì •ë³´ ì œê³µ ê°€ëŠ¥

        with tab3:
            st.markdown(f"**ìŠ¤íŠ¸ë ˆìŠ¤ ìƒí™© ë° ëŒ€ì²˜:** {details.get('stress_response', 'ì •ë³´ ì—†ìŒ')}")
            st.markdown(f"**ì„±ì¥ì„ ìœ„í•œ ê°œë°œ í¬ì¸íŠ¸:**")
            for point in details.get("development_points", []):
                st.markdown(f"- {point}")

        with tab4:
            st.subheader(f"{user_mbti} ìœ í˜•ì—ê²Œ ì¶”ì²œí•˜ëŠ” ì§ì—…êµ°")
            if "recommended_jobs_detailed" in details:
                for job, job_info in details["recommended_jobs_detailed"].items():
                    with st.expander(f"**{job}**"):
                        st.markdown(f"**ğŸ¤” ì´ ì§ì—…ì´ ì™œ ì˜ ë§ì„ê¹Œìš”?**\n {job_info.get('reason', 'ì •ë³´ ì—†ìŒ')}")
                        st.markdown(f"**ğŸ“‹ ì£¼ìš” ì—…ë¬´:**")
                        for task in job_info.get("tasks", []):
                            st.markdown(f"  - {task}")
                        st.markdown(f"**ğŸ’¡ í•„ìš” ì—­ëŸ‰:**")
                        for skill in job_info.get("skills", []):
                            st.markdown(f"  - {skill}")
                        # st.link_button("ê´€ë ¨ ì •ë³´ ë” ë³´ê¸°", "ì›Œí¬ë„·_ë§í¬_ë“±") # ì‹¤ì œ ë§í¬ë¡œ
            else:
                st.write("ì¶”ì²œ ì§ì—… ì •ë³´ê°€ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.")
    else:
        st.warning("í•´ë‹¹ MBTI ìœ í˜•ì— ëŒ€í•œ ìƒì„¸ ì •ë³´ê°€ ì•„ì§ ì¤€ë¹„ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.")

    if st.button("ğŸ”„ ë‹¤ì‹œ ê²€ì‚¬í•˜ê¸°"):
        del st.session_state.mbti_result
        if 'mbti_scores' in st.session_state:
            del st.session_state.mbti_scores
        st.experimental_rerun()

st.markdown("---")
st.caption("ë³¸ MBTI ë¶„ì„ ì •ë³´ëŠ” ì¼ë°˜ì ì¸ ê²½í–¥ì„±ì„ ë°”íƒ•ìœ¼ë¡œ í•˜ë©°, ê°œì¸ì˜ íŠ¹ì„±ì€ ë‹¤ë¥¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìê¸° ì´í•´ë¥¼ ìœ„í•œ ì°¸ê³  ìë£Œë¡œ í™œìš©í•˜ì‹œê¸° ë°”ëë‹ˆë‹¤.")
